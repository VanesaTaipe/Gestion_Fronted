<div class="min-h-screen flex">
  <!-- Lado izquierdo - Imagen -->
  <div
    class="hidden lg:flex lg:w-1/2 bg-cover bg-center"
    style="background-image: url('assets/im-re-lo.png');"
  ></div>

  <!-- Lado derecho - Formulario con scroll -->
  <div class="w-full lg:w-1/2 bg-gray-50 flex flex-col items-center justify-start p-8 overflow-y-auto h-screen">
    <div class="w-full max-w-md">
      <!-- Logo -->
      <div class="flex justify-center mb-8">
        <img src="assets/kanban-logo.png" alt="kanban logo" class="w-24 h-24" />
      </div>

      <!-- Pestañas  Nuevooo -->
      @if (authType !== 'completar') {
        <div class="bg-[#7ee5d8] rounded-full p-2 flex gap-2 mb-8">
          <button
            [class.bg-[#40E0D0]]="authType === 'login'"
            [class.text-black]="authType === 'login'"
            [class.bg-transparent]="authType !== 'login'"
            [class.text-white]="authType !== 'login'"
            class="flex-1 py-3 px-6 rounded-full font-semibold transition-all"
            (click)="switchToLogin()"
          >
            Iniciar Sesión
          </button>

          <button
            [class.bg-[#40E0D0]]="authType === 'register'"
            [class.text-black]="authType === 'register'"
            [class.bg-transparent]="authType !== 'register'"
            [class.text-white]="authType !== 'register'"
            class="flex-1 py-3 px-6 rounded-full font-semibold transition-all"
            (click)="switchToRegister()"
          >
            Regístrate
          </button>
        </div>
      }
      <!-- Formulario -->
      <form [formGroup]="authForm" (ngSubmit)="submitForm()" class="space-y-6">

      
        <!-- Completar perfil del usuario temporal Rodrigo Nuevooo -->
        
        @if (authType === "completar") {
          <h2 class="text-xl font-bold mb-6 text-center">
            Completar tu perfil antes de ingresar
          </h2>

          <!-- Nombre Nuevooo -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Nombre</label>
            <input
              formControlName="nombre"
              class="w-full px-4 py-3 border-2 border-gray-300 rounded-full focus:border-[#40E0D0]"
              placeholder="Ingresa tu nombre"
              type="text"
            />
          </div>

          <!-- DNI -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">DNI</label>
            <input
              formControlName="dni"
              class="w-full px-4 py-3 border-2 border-gray-300 rounded-full focus:border-[#40E0D0]"
              placeholder="Ingresa tu DNI"
              type="text"
            />
          </div>

          <!-- Nueva contraseña  Nuevooo -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Nueva contraseña</label>
            <div class ="relative">
              <input
                formControlName="password"
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-full focus:border-[#40E0D0]"
                placeholder="Nueva contraseña"
                [type]="showPassword ? 'text' : 'password' "
              />

              <button
                type="button"
                (click)="togglePassword()"
                class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700">
                <mat-icon>{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
            </div>

            @if (authForm.get('password')?.value){
              <div class="mt-3 space-y-2">
                <!--Barra de seguridad xd  Nuevooo Rodrigo-->
                <div class="flex items-center gap-2">
                  <div class="flex-1 bg-gray-200 rounded-full h-2">
                    <div
                      class="h-2 rounded-full transition-all duration-300"
                      [style.width.%]="passwordStrength.strength"
                      [style.background-color]="getStrengthColor()">
                    </div>
                  </div>
                  <span class="text-xs font-medium" [style.color]="getStrengthColor()">
                    {{ getStrengthText() }}
                  </span>
                </div>

                <!-- Lista de requisitos  Nuevooo -->
                <div class="space-y-1 text-xs ml-4">

                  <div class="flex items-center gap-2" 
                       [class.text-green-600]="passwordStrength.hasExactLength"
                       [class.text-gray-500]="!passwordStrength.hasExactLength">
                    <mat-icon class="text-base">{{ passwordStrength.hasExactLength ? 'check_circle' : 'cancel' }}</mat-icon>
                    <span>Exactamente 6 caracteres</span>
                  </div>

                  <div class="flex items-center gap-2" 
                        [class.text-green-600]="passwordStrength.hasUpperCase"
                        [class.text-gray-500]="!passwordStrength.hasUpperCase">
                      <mat-icon class="text-base">{{ passwordStrength.hasUpperCase ? 'check_circle' : 'cancel' }}</mat-icon>
                      <span>Al menos una mayúscula</span>
                  </div>

                  <div class="flex items-center gap-2" 
                        [class.text-green-600]="passwordStrength.hasLowerCase"
                        [class.text-gray-500]="!passwordStrength.hasLowerCase">
                      <mat-icon class="text-base">{{ passwordStrength.hasLowerCase ? 'check_circle' : 'cancel' }}</mat-icon>
                      <span>Al menos una minúscula</span>
                  </div>

                  <div class="flex items-center gap-2" 
                        [class.text-green-600]="passwordStrength.hasNumber"
                        [class.text-gray-500]="!passwordStrength.hasNumber">
                      <mat-icon class="text-base">{{ passwordStrength.hasNumber ? 'check_circle' : 'cancel' }}</mat-icon>
                     <span>Al menos un número</span>
                  </div>

                  <div class="flex items-center gap-2" 
                        [class.text-green-600]="passwordStrength.hasSpecialChar"
                        [class.text-gray-500]="!passwordStrength.hasSpecialChar">
                      <mat-icon class="text-base">{{ passwordStrength.hasSpecialChar ? 'check_circle' : 'cancel' }}</mat-icon>
                      <span>Al menos un carácter especial (!@#$%...)</span>
                  </div>

                </div>

              </div>
            }
          
          </div>
          <!-- Confirmar contraseña  Nuevooo -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Confirmar contraseña</label>
            <input
              formControlName="confirmPassword"
              class="w-full px-4 py-3 border-2 border-gray-300 rounded-full focus:border-[#40E0D0]"
              placeholder="Repite tu contraseña"
              type="password"
            />
          </div>

          <!-- Botón completar perfil  Nuevooo -->
          <button
            type="submit"
            class="w-full bg-[#40E0D0] hover:bg-[#38c9b8] text-black font-semibold py-3 px-6 rounded-full mt-6"
          >
            Guardar cambios
          </button>
        }

       
        <!-- Login para usuarios registrados  -->
      
        @if (authType !== "completar") {

          <!-- Nombre completo - Solo en registro -->
          @if (authType === "register") {
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Nombre completo
              </label>
              <input
                formControlName="nombre"
                placeholder="Ingresa tu nombre"
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-full focus:border-[#40E0D0] focus:outline-none"
                type="text"
              />
              <div
                *ngIf="authForm.get('nombre')?.touched && authForm.get('nombre')?.invalid"
                class="text-red-500 text-sm mt-1 ml-4"
              >
                El nombre debe tener al menos 3 caracteres
              </div>
            </div>
          }

          <!-- DNI - Solo en registro -->
          @if (authType === "register") {
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                DNI
              </label>
              <input
                formControlName="dni"
                placeholder="Ingresa tu DNI"
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-full focus:border-[#40E0D0] focus:outline-none"
                type="text"
              />
              <div
                *ngIf="authForm.get('dni')?.touched && authForm.get('dni')?.invalid"
                class="text-red-500 text-sm mt-1 ml-4"
              >
                El DNI debe tener al menos 8 dígitos numéricos
              </div>
            </div>
          }

          <!-- Correo electrónico -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Correo electrónico
            </label>
            <input
              formControlName="correo"
              placeholder="Ingresa tu correo electrónico"
              class="w-full px-4 py-3 border-2 border-gray-300 rounded-full focus:border-[#40E0D0] focus:outline-none"
              type="email"
            />
            <div
              *ngIf="authForm.get('correo')?.touched && authForm.get('correo')?.invalid"
              class="text-red-500 text-sm mt-1 ml-4"
            >
              Ingresa un correo válido
            </div>
          </div>

          <!-- Contraseña -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Contraseña
            </label>
            <div class="relative">
              <input
                formControlName="password"
                [type]="showPassword ? 'text' : 'password'"
                placeholder="{{authType === 'register' ? 'Crear contraseña' : 'Ingresa tu contraseña'}}"
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-full focus:border-[#40E0D0] focus:outline-none pr-12"
              />
              <button
                type="button"
                (click)="togglePassword()"
                class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700"
              >
                <mat-icon>{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
            </div>

            <!-- Indicador de fortaleza - SOLO EN REGISTRO -->
            @if (authType === "register" && authForm.get('password')?.value) {
              <div class="mt-3 space-y-2">
                <div class="flex items-center gap-2">
                  <div class="flex-1 bg-gray-200 rounded-full h-2">
                    <div
                      class="h-2 rounded-full transition-all duration-300"
                      [style.width.%]="passwordStrength.strength"
                      [style.background-color]="getStrengthColor()"
                    ></div>
                  </div>
                  <span
                    class="text-xs font-medium"
                    [style.color]="getStrengthColor()"
                  >
                    {{ getStrengthText() }}
                  </span>
                </div>

                <div class="space-y-1 text-xs ml-4">
                  <div
                    class="flex items-center gap-2"
                    [class.text-green-600]="passwordStrength.hasExactLength"
                    [class.text-gray-500]="!passwordStrength.hasExactLength"
                  >
                    <mat-icon class="text-base">
                      {{ passwordStrength.hasExactLength ? 'check_circle' : 'cancel' }}
                    </mat-icon>
                    <span>Exactamente 6 caracteres</span>
                  </div>
                  <div
                    class="flex items-center gap-2"
                    [class.text-green-600]="passwordStrength.hasUpperCase"
                    [class.text-gray-500]="!passwordStrength.hasUpperCase"
                  >
                    <mat-icon class="text-base">
                      {{ passwordStrength.hasUpperCase ? 'check_circle' : 'cancel' }}
                    </mat-icon>
                    <span>Al menos una mayúscula</span>
                  </div>
                  <div
                    class="flex items-center gap-2"
                    [class.text-green-600]="passwordStrength.hasLowerCase"
                    [class.text-gray-500]="!passwordStrength.hasLowerCase"
                  >
                    <mat-icon class="text-base">
                      {{ passwordStrength.hasLowerCase ? 'check_circle' : 'cancel' }}
                    </mat-icon>
                    <span>Al menos una minúscula</span>
                  </div>
                  <div
                    class="flex items-center gap-2"
                    [class.text-green-600]="passwordStrength.hasNumber"
                    [class.text-gray-500]="!passwordStrength.hasNumber"
                  >
                    <mat-icon class="text-base">
                      {{ passwordStrength.hasNumber ? 'check_circle' : 'cancel' }}
                    </mat-icon>
                    <span>Al menos un número</span>
                  </div>
                  <div
                    class="flex items-center gap-2"
                    [class.text-green-600]="passwordStrength.hasSpecialChar"
                    [class.text-gray-500]="!passwordStrength.hasSpecialChar"
                  >
                    <mat-icon class="text-base">
                      {{ passwordStrength.hasSpecialChar ? 'check_circle' : 'cancel' }}
                    </mat-icon>
                    <span>Al menos un carácter especial (!@#$%...)</span>
                  </div>
                </div>
              </div>
            }

            <!-- Error de contraseña en login -->
            <div
              *ngIf="authForm.get('password')?.touched && authForm.get('password')?.invalid && authType === 'login'"
              class="text-red-500 text-sm mt-1 ml-4"
            >
              La contraseña es requerida
            </div>
          </div>

          <!-- Confirmar contraseña - Solo en registro -->
          @if (authType === "register") {
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Confirmar contraseña
              </label>
              <div class="relative">
                <input
                  formControlName="confirmPassword"
                  [type]="showConfirmPassword ? 'text' : 'password'"
                  placeholder="Vuelve a colocar tu contraseña"
                  class="w-full px-4 py-3 border-2 border-gray-300 rounded-full focus:border-[#40E0D0] focus:outline-none pr-12"
                />
                <button
                  type="button"
                  (click)="toggleConfirmPassword()"
                  class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700"
                >
                  <mat-icon>{{ showConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                </button>
              </div>
              <div
                *ngIf="authForm.hasError('passwordMismatch') && authForm.get('confirmPassword')?.touched"
                class="text-red-500 text-sm mt-1 ml-4"
              >
                Las contraseñas no coinciden
              </div>
            </div>
          }

          <!-- Recordarme y olvidé contraseña - Solo en login -->
          @if (authType === "login") {
            <div class="flex items-center justify-between">
              <label class="flex items-center">
                <input
                  type="checkbox"
                  class="rounded border-gray-300 text-[#40E0D0] focus:ring-[#40E0D0]"
                />
                <span class="ml-2 text-sm text-gray-600">Recuérdame</span>
              </label>
              <a
                (click)="goToForgotPassword()"
                class="text-sm text-[#40E0D0] hover:text-[#38c9b8] cursor-pointer font-medium"
              >
                ¿Olvidaste la contraseña?
              </a>
            </div>
          }

          <!-- Botón de envío login / registro -->
          <button
            type="submit"
            [disabled]="!authForm.valid || isSubmitting"
            class="w-full bg-[#40E0D0] hover:bg-[#38c9b8] text-black font-semibold py-3 px-6 rounded-full disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"
          >
            {{ authType === 'login' ? 'Iniciar sesión' : 'Regístrate' }}
          </button>
        }

        <!-- Errores (visible en cualquier flujo) -->
        <app-list-errors [errors]="errors" />
      </form>
    </div>
  </div>
</div>
