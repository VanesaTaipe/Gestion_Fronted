<!-- Tarjeta -->
<div
  class="bg-white rounded-xl shadow p-3 hover:shadow-md transition cursor-pointer select-none"
  (click)="openDetail()"
>
  <!-- Encabezado: título + acciones -->
  <div class="flex items-start justify-between gap-3">
    <h3 class="font-semibold text-gray-800 leading-snug break-words">
      {{ card.title }}
    </h3>

    <!-- Acciones editar / eliminar -->
    <div class="flex items-center gap-1 shrink-0">
      <button class="icon-btn" aria-label="Editar" (click)="onEdit($event)">
        <mat-icon fontIcon="edit"></mat-icon>
      </button>
      <button class="icon-btn text-red-600" aria-label="Eliminar" (click)="onRemove($event)">
        <mat-icon fontIcon="delete"></mat-icon>
      </button>

     
      
    </div>
  </div>

  <!-- Asignado -->
  <div class="mt-1 text-sm text-gray-600 flex items-center gap-2">
    <img src="assets/user.png" class="w-4 h-4" alt="user">
    <ng-container *ngIf="card.asignado_a || card.id_asignado; else sinAsignar">
      <span class="font-medium">
        {{ card.asignado_a || ('#' + card.id_asignado) }}
      </span>
    </ng-container>
    <ng-template #sinAsignar>
      <span class="text-gray-400 italic">sin asignar</span>
    </ng-template>
  </div>

  <!-- Badges -->
  <div class="mt-2 flex items-center gap-2">
    <span *ngIf="card.prioridad" [ngClass]="priorityClass()">
      {{ card.prioridad }}
    </span>

    <span *ngIf="card.tag" class="badge badge-gray">
      {{ card.tag }}
    </span>

    <span *ngIf="card.fecha_vencimiento" class="badge badge-gray">
      {{ card.fecha_vencimiento | date:'yyyy-MM-dd' }}
    </span>
  </div>

  <!-- Vista previa de descripción (1ra línea) -->
  <div 
  *ngIf="descPreview" 
  class="mt-2 text-sm text-gray-700 line-clamp-1"
  [innerHTML]="parseMarkdown(descPreview)">
  </div>
</div>

<!-- ===== Modal Detalle ===== -->
<div *ngIf="showDetail" class="fixed inset-0 z-50 flex items-center justify-center bg-black/40" (click)="closeDetail()">
  <div class="bg-white w-[560px] max-w-[95vw] rounded-2xl shadow-xl p-6" (click)="$event.stopPropagation()">
    <div class="flex items-start justify-between">
      <h3 class="text-lg font-semibold">Detalle de la tarea</h3>
      <button class="icon-btn" aria-label="Cerrar" (click)="closeDetail($event)">
        <mat-icon fontIcon="close"></mat-icon>
      </button>
    </div>

    <div class="mt-3 space-y-3">
      <div>
        <div class="text-xs text-gray-500">Título</div>
        <div class="text-base font-medium text-gray-900 break-words">{{ card.title }}</div>
      </div>

      <div>
        <div class="text-xs text-gray-500">Descripción</div>
        <div class="text-sm text-gray-800 whitespace-pre-wrap"
        [innerHTML]="parseMarkdown(card.descripcion || '—')">
        </div>
      </div>

      <div class="grid grid-cols-2 gap-3">
        <div>
          <div class="text-xs text-gray-500">Asignado</div>
          <div class="text-sm text-gray-800">
            {{ card.asignado_a || (card.id_asignado ? ('#' + card.id_asignado) : '—') }}
          </div>
        </div>
        <div>
          <div class="text-xs text-gray-500">Vence</div>
          <div class="text-sm text-gray-800">
            {{ card.fecha_vencimiento ? (card.fecha_vencimiento | date:'mediumDate') : '—' }}
          </div>
        </div>
      </div>

      <div>
        <div class="text-xs text-gray-500">Prioridad</div>
        <span *ngIf="card.prioridad" [ngClass]="priorityClass()">
          {{ card.prioridad }}
        </span>
        <span *ngIf="!card.prioridad" class="text-sm text-gray-800">—</span>
      </div>
    </div>
  </div>
</div>
